@model Obidalar.Models.ObidaViewModelDetails

@{
    ViewData["Title"] = "Obida Tafsilotlari";
}

<h2 class="text-center mb-4">🕌 @Model.Nomi</h2>

<!-- Obida tafsilotlari -->
<div class="container">
    <div class="row">
        <div class="col-12">
            <h4>Viloyat: @Model.Viloyat</h4>
            <h5>Yil: @Model.Yil</h5>
            <h5>Rating: @Model.Rating</h5>
            <h5>ViewCount: @Model.ViewCount</h5>
            <p><strong>Tavsif:</strong> @Model.Tavsif</p>
            <p><strong>Yaratilgan sana:</strong> @Model.CreatedAt.ToLocalTime().ToString("yyyy-MM-dd HH:mm:ss")</p>
        </div>
    </div>

    <!-- Medialar (rasmlar/video) -->
    @if (Model.Medialar.Any())
    {
        <h4 class="mt-4">Medialar:</h4>
        <div class="row">
            @foreach (var media in Model.Medialar)
            {
                <div class="col-12 col-md-4 mb-4">
                    @if (media.Type == Obidalar.Models.MediaType.Image)
                    {
                        <img src="@media.MediaUrl" alt="Obida rasmi" class="img-fluid" />
                    }
                    else if (media.Type == Obidalar.Models.MediaType.Video)
                    {
                        <video width="100%" controls>
                            <source src="@media.MediaUrl" type="video/mp4">
                            Sizning brauzeringiz video tagini qo‘llab-quvvatlamaydi.
                        </video>
                    }
                </div>
            }
        </div>
    }

    <!-- Sharhlar -->
    @if (Model.Sharhlar.Any())
    {
        <h4 class="mt-4">Sharhlar:</h4>
        <ul class="list-group">
            @foreach (var sharh in Model.Sharhlar)
            {
                <li class="list-group-item">
                    <p><strong>@sharh.User.Ism</strong> (@sharh.Sana.ToLocalTime().ToString("yyyy-MM-dd HH:mm:ss"))</p>
                    <p>@sharh.Matn</p>
                </li>
            }
        </ul>
    }
    else
    {
        <div class="alert alert-info mt-4">
            Hali sharhlar mavjud emas.
        </div>
    }

    <!-- Batafsil tugmasi: Bu yerda foydalanuvchi obidani tahrirlash uchun imkoniyat olishi mumkin -->
    <div class="mt-4 d-flex gap-2 flex-wrap">
        <a href="@Url.Action("Edit", "Obida", new { id = Model.Id })" class="btn btn-warning">✏️ Tahrirlash</a>

        <!-- O'chirish formasi -->
        <form method="post" asp-action="Delete" asp-controller="Obida" asp-route-id="@Model.Id" onsubmit="return confirm('Rostdan ham ushbu obidani o‘chirmoqchimisiz?');">
            <button type="submit" class="btn btn-danger">🗑️ O‘chirish</button>
        </form>

        <a href="@Url.Action("Index", "Admin")" class="btn btn-secondary">🔙 Orqaga</a>
    </div>

</div>

<!-- Modal: O'chirishni tasdiqlash -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteConfirmModalLabel">Obidani o‘chirish</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Yopish"></button>
            </div>
            <div class="modal-body">
                Rostdan ham ushbu obidani o‘chirmoqchimisiz?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bekor qilish</button>

                <!-- O‘chirish formasi ichida submit tugmasi -->
                <form method="post" asp-action="Delete" asp-controller="Obida" asp-route-id="@Model.Id">
                    <button type="submit" class="btn btn-danger">Ha, o‘chirish</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


